<!-- layout.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100..900&display=swap"
    rel="stylesheet"
  />

  <!-- Font Awesome 6 (CDN) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    integrity="sha512-ns8...someLongHash..."
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Your main CSS file -->
  <link rel="stylesheet" href="/styles.css" />

  <title>APP</title>
</head>
<body class="<%= isWelcomePage ? 'welcome-page' : '' %>">
  <!-- Content wrapper to enforce navbar clearance -->
  <div class="content-wrapper">
    <div class="container">
      <%- body %>
    </div>
  </div>

  <% if (currentUser) { %>
    <!-- Bottom nav bar -->
    <nav class="bottom-nav">
      <a href="/home" class="nav-item">
        <i class="fa-solid fa-home"></i>
      </a>
      <a href="/notifications" class="nav-item">
        <i class="fa-solid fa-bell"></i>
      </a>
      <a href="/chats" class="nav-item">
        <i class="fa-solid fa-comments"></i>
      </a>
      <a href="javascript:void(0)" class="nav-item profile-nav-trigger">
        <i class="fa-solid fa-user"></i>
      </a>
    </nav>

    <!-- Slide-Out Profile Menu -->
    <aside class="profile-menu" id="profileMenu">
      <div class="profile-menu-header">
        <img
          src="<%= currentUser.profilePicture || '/Uploads/default-profile-picture.jpg' %>"
          alt="<%= currentUser.username %>"
          class="profile-menu-avatar"
        />
        <span class="profile-menu-username"><%= currentUser.username %></span>
      </div>

      <ul class="profile-menu-links">
        <li><a href="/profile">My Profile</a></li>
        <li><a href="/bookmarks">Bookmarks</a></li>
        <li><a href="/profile/edit">Edit Profile</a></li>
        <% if (currentUser && currentUser.role === 'user') { %>
          <li><a href="/request-creator">Request to be a Creator</a></li>
          <li><a href="/purchased-content">Purchased Content</a></li>
        <% } %>
        <li><a href="/dashboard">Dashboards</a></li>
        <li><a href="">Subscriptions</a></li>
        <li><a href="">Help and Support</a></li>
        <% if (currentUser && currentUser.role === 'creator') { %>
          <li><a href="/referrals">Referrals</a></li>
        <% } %>
        <li><a href="/change-password">Change Password</a></li>
        <li><a href="/logout">Logout</a></li>
      </ul>
    </aside>
  <% } %>

  <% if (currentUser) { %>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const profileNavTrigger = document.querySelector('.profile-nav-trigger');
        const profileMenu = document.getElementById('profileMenu');
    
        // Toggle menu on icon click (works for both mobile and desktop)
        profileNavTrigger.addEventListener('click', () => {
          profileMenu.classList.toggle('open');
        });
    
        // Close menu if clicking outside of it (works for both mobile and desktop)
        document.addEventListener('click', (event) => {
          if (
            profileMenu.classList.contains('open') &&
            !profileMenu.contains(event.target) &&
            !profileNavTrigger.contains(event.target)
          ) {
            profileMenu.classList.remove('open');
          }
        });
      });
    </script>
  <% } %>
</body>
</html>