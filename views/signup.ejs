<!-- views/signup.ejs -->

<div class="sel-signup-page">

  <!-- 1. Top ‚ÄúAlready have an account?‚Äù box -->
  <div class="sel-signup-options">
    <p>
      Already have an account?
      <span class="sel-getstarted-box">
        <% 
          // Build query string for redirect back to welcome ("/")
          const queryParts = [];
          if (creator) queryParts.push('creator=' + encodeURIComponent(creator));
          if (ref)     queryParts.push('ref='     + encodeURIComponent(ref));
        %>
        <a
          href="/<%= queryParts.length ? '?' + queryParts.join('&') : '' %>"
          class="sel-signup-link"
        >
          Sign In
        </a>
      </span>
    </p>
  </div>

  <!-- 2. Branded Header -->
  <header class="sel-logo-header">
    <a href="/home" class="sel-logo-link">
      <!-- First logo -->
      <img
        src="https://storage.googleapis.com/my-public-profile-pictures/logos/elitefans-logo.PNG"
        alt="EliteFans Logo"
        class="sel-site-logo"
      >
      <!-- Second logo (white variant) -->
      <img
        src="https://storage.googleapis.com/my-public-profile-pictures/logos/Elite%20Fans%20Logo%20(White).png"
        alt="EliteFans White Logo"
        class="sel-site-logo secondary-logo"
      >
    </a>
  </header>

  <!-- 3. White card + embedded pill via CSS -->
  <div class="sel-content-section">
    <div class="sel-welcome-container">
      <h2 class="sel-heading">Join EliteFans</h2>
      <p class="sel-subheading">
        Create your account to unlock exclusive perks, chat with creators, and support your favorites.
      </p>

      <% if (errorMessage && errorMessage.length) { %>
        <div class="sel-error-message"><%= errorMessage %></div>
      <% } %>

      <!-- 4. Sign-up form -->
      <form
        id="sel-signupForm"
        action="/signup<%= queryParts.length ? '?' + queryParts.join('&') : '' %>"
        method="POST"
        class="sel-signup-form"
      >
        <% if (creator) { %>
          <input type="hidden" name="creator" value="<%= creator %>">
        <% } %>
        <% if (ref) { %>
          <input type="hidden" name="ref" value="<%= ref %>">
        <% } %>

        <h3 class="sel-form-title">Create Your Account</h3>

        <input
          type="text"
          name="username"
          placeholder="Username"
          required
          class="sel-input"
        >

        <input
          type="email"
          name="email"
          placeholder="Email Address"
          required
          class="sel-input"
        >

        <div class="sel-password-container">
          <input
            type="password"
            name="password"
            placeholder="Password"
            required
            class="sel-input"
          >
          <span class="sel-toggle-password">üëÅÔ∏è</span>
        </div>
        <div id="sel-passwordError" class="sel-password-error"></div>

        <button type="submit" class="sel-button-signup">Sign Up</button>
      </form>
    </div>
  </div>

</div><!-- /.sel-signup-page -->

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const togglePassword = document.querySelector('.sel-toggle-password');
    const passwordInput  = document.querySelector('input[name="password"]');
    const usernameInput  = document.querySelector('input[name="username"]');
    const emailInput     = document.querySelector('input[name="email"]');
    const form           = document.getElementById('sel-signupForm');
    const errorDiv       = document.getElementById('sel-passwordError');

    function validatePassword() {
      const pwd      = passwordInput.value;
      const uname    = usernameInput.value.toLowerCase();
      const emailL   = emailInput.value.toLowerCase();
      let msg        = '';

      if (pwd.length < 8) {
        msg = 'At least 8 characters.';
      } else {
        const checks = [
          /[A-Z]/.test(pwd),
          /[a-z]/.test(pwd),
          /[0-9]/.test(pwd),
          /[!@#$%^&*]/.test(pwd)
        ].filter(Boolean).length;
        if (checks < 3) {
          msg = 'Include 3 of: uppercase, lowercase, number, symbol.';
        } else if (pwd.toLowerCase().includes(uname) || pwd.toLowerCase().includes(emailL)) {
          msg = 'Don‚Äôt include username or email.';
        }
      }

      errorDiv.textContent   = msg;
      errorDiv.style.display = msg ? 'block' : 'none';
    }

    togglePassword.addEventListener('click', () => {
      const type = passwordInput.type === 'password' ? 'text' : 'password';
      passwordInput.type = type;
      togglePassword.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
    });

    passwordInput.addEventListener('input', validatePassword);
    usernameInput.addEventListener('input', validatePassword);
    emailInput.addEventListener('input', validatePassword);

    form.addEventListener('submit', function(e) {
      validatePassword();
      if (errorDiv.textContent) e.preventDefault();
    });
  });
</script>
